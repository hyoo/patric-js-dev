Ext.define("VBI.Workspace.controller.ColumnBrowser",{extend:"Ext.app.Controller",init:function(){this.control({columnbrowser:{columnbrowserfilter:this.onColumnBrowserFilter},"columnbrowser button":{columnbrowserfilter_reset:this.onColumnBrowserReset}})},onColumnBrowserReset:function(b){var c=Ext.data.StoreManager.lookup("Mappings");var a=Ext.data.StoreManager.lookup("Features");if(b=="groups"){c.setTrackFilter("Group",null);c.setTrackFilter("String",null);a.filterByTracks(c.getFilteredTracks());this.resetColumnBrowserGroupsUI();this.resetColumnBrowserTagsUI()}else{if(b=="tags"){c.setTrackFilter("String",null);a.filterByTracks(c.getFilteredTracks());this.resetColumnBrowserTagsUI()}}},onColumnBrowserFilter:function(h,g){var a=Ext.data.StoreManager.lookup("Mappings");var f=Ext.data.StoreManager.lookup("ColumnBrowser.Tags");var j=Ext.data.StoreManager.lookup("Features");var i=Ext.data.StoreManager.lookup("Genomes");var b=Ext.data.StoreManager.lookup("Groups");if(h=="groups"){var e=new Array();Ext.each(g,function(k){e.push(k.get("tagId"))});a.setTrackFilter("Group",e);a.setTrackFilter("String",null);this.resetColumnBrowserTagsUI();var d=a.getFilteredTracks();j.filterByTracks(d);i.filterByTracks(d);var c=a.getTagsByTrack(d);f.filterByTag(c);b.filterByTag(e)}else{if(h=="tags"){var c=new Array();Ext.each(g,function(k){c.push(k.get("tagId"))});a.setTrackFilter("String",c);var d=a.getFilteredTracks();j.filterByTracks(d);i.filterByTracks(d)}}},resetColumnBrowserGroupsUI:function(){Ext.getCmp("columnbrowser_groups").getSelectionModel().deselectAll()},resetColumnBrowserTagsUI:function(){Ext.getCmp("columnbrowser_tags").getSelectionModel().deselectAll()}});Ext.define("VBI.Workspace.controller.Feature",{extend:"Ext.app.Controller",init:function(){this.control({"featuretoolbar button":{runMSAFeature:this.runMSAFeature},"featuretoolbar menuitem":{ShowDownloadFasta:this.ShowDownloadFasta,downloadGrid:this.downloadGrid,callIDMapping:this.runIDMapping}})},runMSAFeature:function(a){Ext.Ajax.request({url:"/portal/portal/patric/FIGfamSorter/FigFamSorterWindow?action=b&cacheability=PAGE",method:"POST",params:{featureIds:a,callType:"toAligner"},success:function(b,c){document.location.href="TreeAlignerB?cType=&cId=&pk="+b.responseText}})},runIDMapping:function(b,a){Ext.Ajax.request({url:"/portal/portal/patric/IDMapping/IDMappingWindow?action=b&cacheability=PAGE",method:"POST",params:{keyword:a,from:"PATRIC ID",to:b,sraction:"save_params"},success:function(c,d){document.location.href="IDMapping?cType=&cId=&dm=result&pk="+c.responseText+"#key="+Math.floor(Math.random()*10001)+"&pS=20&aP=1&dir=ASC&sort=genome_name,accession,start_max"}})},ShowDownloadFasta:function(c,b,a){Ext.getDom("fTableForm").action="/patric-common/jsp/fasta_download_handler.jsp";Ext.getDom("fastaaction").value=c;Ext.getDom("fastascope").value="Selected";Ext.getDom("fastatype").value=b;Ext.getDom("fids").value=a;if(c=="display"){window.open("","disp","width=920,height=400,scrollbars,resizable");Ext.getDom("fTableForm").target="disp"}else{Ext.getDom("fTableForm").target=""}Ext.getDom("fTableForm").submit()},downloadGrid:function(b){var c=new Array();var a=Ext.StoreManager.lookup("Features");Ext.Array.each(a.getRange(),function(d){c.push(d.internalId)});Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=b;Ext.getDom("fids").value=c.join(",");Ext.getDom("idType").value="Feature";Ext.getDom("fTableForm").submit()}});Ext.define("VBI.Workspace.controller.Genome",{extend:"Ext.app.Controller",init:function(){this.control({"genometoolbar menuitem":{downloadGrid:this.downloadGrid}})},downloadGrid:function(b){var c=new Array();var a=Ext.StoreManager.lookup("Genomes");Ext.Array.each(a.getRange(),function(d){c.push(d.internalId)});Ext.getDom("fTableForm").action="/patric-searches-and-tools/jsp/grid_download_handler.jsp";Ext.getDom("fTableForm").target="";Ext.getDom("tablesource").value="Workspace";Ext.getDom("fileformat").value=b;Ext.getDom("fids").value=c.join(",");Ext.getDom("idType").value="Genome";Ext.getDom("fTableForm").submit()}});Ext.define("VBI.Workspace.controller.GlobalToolbar",{extend:"Ext.app.Controller",init:function(){this.control({globaltoolbar:{switchToListView:this.onSwitchToListView,switchToGroupView:this.onSwitchToGroupView}})},onSwitchToListView:function(b,c){var a=Ext.getCmp("workspace_view");a.applyState({activeItem:"listview"});a.getLayout().setActiveItem("listview")},onSwitchToGroupView:function(b,c){var a=Ext.getCmp("workspace_view");a.applyState({activeItem:"groupview"});a.getLayout().setActiveItem("groupview")}});Ext.define("VBI.Workspace.controller.Group",{extend:"Ext.app.Controller",init:function(){this.control({"grouptoolbar button":{runGroupExplorer:this.runGroupExplorer},groupbrowser:{itemdblclick:this.switchToGroupViewer},"detailtoolbar > button":{click:this.switchToBrowser},"groupinfoeditor > button":{click:this.toggleEditorFields}})},runGroupExplorer:function(b,a){document.location.href="/portal/portal/patric/GroupManagement?mode=gse&groupType="+a+"&groupId="+b},switchToGroupViewer:function(i,f,j,g,h,k){var d=i.findParentByType("groupview");var a=Ext.getCmp("workspace_ingroupgrid");var b=Ext.data.StoreManager.lookup("Mappings");b.setTrackFilter("Group",f.getId());b.setTrackFilter("String",null);var c=b.getFilteredTracks();if(f.get("type")=="Feature"){d.showFeatureGroupDetail();a.getLayout().setActiveItem("features");Ext.StoreManager.lookup("Features").filterByTracks(c);Ext.getCmp("workspace_groupinfoeditor").loadRecord(f)}else{if(f.get("type")=="Genome"){d.showGenomeGroupDetail();a.getLayout().setActiveItem("genomes");Ext.StoreManager.lookup("Genomes").filterByTracks(c);Ext.getCmp("workspace_groupinfoeditor").loadRecord(f)}}},switchToBrowser:function(b,c,a){b.findParentByType("groupview").showGroupBrowser()},toggleEditorFields:function(b,c,a){var d=b.findParentByType("groupinfoeditor");b.pressed?d.startEdit():d.finishEdit()}});Ext.define("VBI.Workspace.controller.Station",{extend:"Ext.app.Controller",init:function(){this.control({stationslist:{itemclick:this.onStationSelect}})},onStationSelect:function(k,h,m,i,j,p){var o=h.get("type");if(o==""){return false}var b=Ext.data.StoreManager.lookup("Mappings");var c=Ext.data.StoreManager.lookup("ColumnBrowser.Groups");var g=Ext.data.StoreManager.lookup("ColumnBrowser.Tags");var n=Ext.data.StoreManager.lookup("Features");var l=Ext.data.StoreManager.lookup("Genomes");var a=Ext.data.StoreManager.lookup("Groups");c.clearFilter();c.filter("type",o);var f=new Array();Ext.Array.each(c.getRange(),function(e){f.push(e.get("tagId"))});b.setTrackFilter("Group",f);b.setTrackFilter("String",null);var d=b.getFilteredTracks();if(o=="Feature"){n.filterByTracks(d);this.showFeatureListPanel()}else{if(o=="Genome"){l.filterByTracks(d);this.showGenomeListPanel()}}var f=b.getTagsByTrack(d);g.filterByTag(f);Ext.getCmp("columnbrowser_groups").getSelectionModel().deselectAll();Ext.getCmp("columnbrowser_tags").getSelectionModel().deselectAll();a.clearFilter();a.filter("type",o);Ext.getCmp("workspace_groupview").showGroupBrowser()},showFeatureListPanel:function(){Ext.getCmp("workspace_listview").getLayout().setActiveItem("featureview")},showGenomeListPanel:function(){Ext.getCmp("workspace_listview").getLayout().setActiveItem("genomeview")}});Ext.define("VBI.Workspace.model.ColumnBrowser",{extend:"Ext.data.Model",fields:["tagId","name","tagType","type"],idProperty:"tagId",});Ext.define("VBI.Workspace.model.Feature",{extend:"Ext.data.Model",idProperty:"na_feature_id",fields:["aa_length","accession","annotation","end_min","feature_type","genome_name","gid","locus_tag","na_feature_id","na_length","product","refseq_locus_tag","refseq_protein_id","start_max","strand"]});Ext.define("VBI.Workspace.model.Genome",{extend:"Ext.data.Model",idProperty:"gid",fields:["ncbi_tax_id","genome_name","rast_cds","refseq_cds","brc_cds","chromosome","contig","plasmid","length","gid"]});Ext.define("VBI.Workspace.model.Group",{extend:"Ext.data.Model",fields:["tagId","name","members","cdate","mdate","desc","type",{name:"thumb",convert:function(b,a){return"/patric/images/workspace_"+a.get("type").toLowerCase()+"_group.png"}}],idProperty:"tagId"});Ext.define("VBI.Workspace.model.Mapping",{extend:"Ext.data.Model",fields:["trackId","tagId"]});Ext.define("VBI.Workspace.model.Station",{extend:"Ext.data.Model",fields:["id","name","type","leaf",{name:"iconCls",type:"string",defaultValue:"x-tree-noicon"}],idProperty:"id"});Ext.define("VBI.Workspace.store.ColumnBrowser.Groups",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ColumnBrowser",model:"VBI.Workspace.model.ColumnBrowser"});Ext.define("VBI.Workspace.store.ColumnBrowser.Tags",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ColumnBrowser",model:"VBI.Workspace.model.ColumnBrowser",filterByTag:function(a){this.clearFilter();this.filter([Ext.create("Ext.util.Filter",{filterFn:function(b){return Ext.Array.contains(a,b.get("tagId"))}})])}});Ext.define("VBI.Workspace.store.ColumnBrowser",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.ColumnBrowser",model:"VBI.Workspace.model.ColumnBrowser",autoLoad:true,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getFacets",reader:{type:"json",root:"results"}},refresh:function(a){Ext.StoreManager.lookup("ColumnBrowser.Groups").removeAll(false);Ext.StoreManager.lookup("ColumnBrowser.Tags").removeAll(false);this.load(a)},listeners:{load:function(a){a.clearFilter();a.filter("tagType","Group");Ext.data.StoreManager.lookup("ColumnBrowser.Groups").add(a.getRange());a.clearFilter();a.filter("tagType","String");Ext.data.StoreManager.lookup("ColumnBrowser.Tags").add(a.getRange())}}});Ext.define("VBI.Workspace.store.Features",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Feature",model:"VBI.Workspace.model.Feature",autoLoad:true,proxy:{type:"ajax",actionMethods:{read:"POST"},url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getFeatures",extraParams:{trackIds:""},reader:{type:"json",root:"results",totalProperty:"total"},noCache:false},stateId:"workspace_pagesize",remoteSort:true,filterByTracks:function(a){if(Ext.isArray(a)){this.getProxy().extraParams.trackIds=a.join(",");this.load()}else{if(Ext.isNumber(a)){this.getProxy().extraParams.trackIds=a;this.load()}}}});Ext.define("VBI.Workspace.store.Genomes",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Genome",model:"VBI.Workspace.model.Genome",autoLoad:true,proxy:{type:"ajax",actionMethods:{read:"POST"},url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getGenomes",extraParams:{trackIds:""},reader:{type:"json",root:"results",totalProperty:"total"},noCache:false},stateId:"workspace_pagesize",remoteSort:true,filterByTracks:function(a){if(Ext.isArray(a)){this.getProxy().extraParams.trackIds=a.join(",");this.load()}else{if(Ext.isNumber(a)){this.getProxy().extraParams.trackIds=a;this.load()}}}});Ext.define("VBI.Workspace.store.Groups",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Group",model:"VBI.Workspace.model.Group",autoLoad:true,proxy:{type:"ajax",api:{read:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getGroups",update:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=updateGroupInfo"},reader:{type:"json",successProperty:"success",root:"results"},writer:{type:"json",writeAllFields:false,root:"group_info",encode:true}},listeners:{write:function(b,a){Ext.StoreManager.lookup("ColumnBrowser").refresh()}},filterByTag:function(a){this.clearFilter();this.filter([Ext.create("Ext.util.Filter",{filterFn:function(b){return Ext.Array.contains(a,b.get("tagId"))}})])}});Ext.define("VBI.Workspace.store.Mappings",{extend:"Ext.data.Store",requires:"VBI.Workspace.model.Mapping",model:"VBI.Workspace.model.Mapping",autoLoad:true,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getMappings"},filterCriteria:{Group:[],String:[]},setTrackFilter:function(b,a){if(b=="Group"){this.filterCriteria.Group=a}else{if(b=="String"){this.filterCriteria.String=a}}},getFilteredTracks:function(){var b=new Array();var d=new Array();var c=new Array();if(!Ext.isEmpty(this.filterCriteria.Group)){var a=Ext.Array.merge(this.filterCriteria.Group);this.each(function(e){if(Ext.Array.contains(a,e.get("tagId"))){d.push(e.get("trackId"))}})}if(!Ext.isEmpty(this.filterCriteria.String)){var a=Ext.Array.merge(this.filterCriteria.String);this.each(function(e){if(Ext.Array.contains(a,e.get("tagId"))){c.push(e.get("trackId"))}})}if(!Ext.isEmpty(d)&&!Ext.isEmpty(c)){if(d.length<c.length){Ext.Array.each(d,function(e){if(Ext.Array.contains(c,e)){b.push(e)}})}else{Ext.Array.each(c,function(e){if(Ext.Array.contains(d,e)){b.push(e)}})}}else{if(!Ext.isEmpty(c)&&Ext.isEmpty(d)){b=c}else{if(!Ext.isEmpty(d)&&Ext.isEmpty(c)){b=d}else{this.each(function(e){b.push(e.get("trackId"))})}}}return b},getTagsByTrack:function(b){var a=new Array();if(Ext.isArray(b)){this.each(function(c){if(Ext.Array.contains(b,c.get("trackId"))){a.push(c.get("tagId"))}})}else{if(Ext.isNumber(tracks)){this.each(function(c){if(c.get("trackId")==b){a.push(c.get("tagId"))}})}}a=Ext.Array.unique(a);return a},listeners:{load:function(b){var a=new Ext.util.DelayedTask(function(){Ext.getCmp("workspace_station").setDefault("Features");Ext.getCmp("workspace_globaltoolbar").switchViewButtons()});a.delay(500)}}});Ext.override(Ext.data.TreeStore,{load:function(b){b=b||{};b.params=b.params||{};var d=this,c=b.node||d.tree.getRootNode(),a;if(!c){c=d.setRootNode({expanded:true})}if(d.clearOnLoad){c.removeAll(false)}Ext.applyIf(b,{node:c});b.params[d.nodeParam]=c?c.getId():"root";if(c){c.set("loading",true)}return d.callParent([b])}});Ext.define("VBI.Workspace.store.Stations",{extend:"Ext.data.TreeStore",requires:"VBI.Workspace.model.Station",model:"VBI.Workspace.model.Station",autoLoad:false,proxy:{type:"ajax",url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=getLibrary"}});Ext.define("VBI.Workspace.view.ColumnBrowser",{extend:"Ext.panel.Panel",alias:"widget.columnbrowser",border:0,layout:{type:"hbox",align:"stretch"},initComponent:function(){this.items=[{xtype:"grid",id:"columnbrowser_groups",stateful:false,flex:1,border:true,store:"ColumnBrowser.Groups",columns:[{header:"Groups",dataIndex:"name",flex:1}],multiSelect:true,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{text:"reset",handler:function(a,b){a.fireEvent("columnbrowserfilter_reset","groups")}}]}],listeners:{scope:this,selectionchange:{fn:function(b,c,a){if(c.length>0){this.fireEvent("columnbrowserfilter","groups",c)}}}}},{xtype:"grid",id:"columnbrowser_tags",stateful:false,flex:1,border:true,store:"ColumnBrowser.Tags",columns:[{header:"Tags",dataIndex:"name",flex:1}],multiSelect:true,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{text:"reset",handler:function(){this.fireEvent("columnbrowserfilter_reset","tags")}}]}],listeners:{scope:this,selectionchange:{fn:function(b,c,a){if(c.length>0){this.fireEvent("columnbrowserfilter","tags",c)}}}}}];this.callParent(arguments)}});Ext.define("VBI.Workspace.view.FeatureToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.featuretoolbar",id:"workspace_featuretoolbar",stateful:false,getSelectedGroup:function(){var a=Ext.getCmp("workspace_view");var c;var b=new Array();if(a.activeItem=="groupview"){c=new Array();b.push(Ext.getCmp("workspace_groupinfoeditor").record.get("tagId"))}else{c=Ext.getCmp("columnbrowser_groups").getSelectionModel().getSelection();Ext.Array.each(c,function(d){b.push(d.get("tagId"))})}return b},getSelectedID:function(){var a=Ext.getCmp("workspace_view");var c;if(a.activeItem=="groupview"){c=Ext.getCmp("workspace_featuregrid").getSelectionModel().getSelection()}else{c=Ext.getCmp("workspace_featureview").getSelectionModel().getSelection()}if(c.length==0){Ext.Msg.alert("Alert","No feature was selected");return null}else{var b=new Array();Ext.Array.each(c,function(d){b.push(d.get("na_feature_id"))});return b}},refreshWorkspaceViews:function(){Ext.StoreManager.lookup("Mappings").load({callback:function(){Ext.StoreManager.lookup("Groups").load({callback:function(){Ext.StoreManager.lookup("ColumnBrowser").refresh({callback:function(){Ext.StoreManager.lookup("Stations").load({callback:function(){Ext.getCmp("workspace_station").setDefault("Features");updateCartInfo()}})}})}})}})},initComponent:function(){this.items=[{title:"Workspace",xtype:"buttongroup",columns:1,items:[{xtype:"tbar_btn_remove",handler:function(b,d){var a=this.findParentByType("featuretoolbar").getSelectedGroup();var c=this.findParentByType("featuretoolbar").getSelectedID();if(c==null){return false}if(a.length==0){Ext.Msg.show({msg:"Do you want to delete this feature from your workspace?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(f,e){if(f=="ok"&&c.length>0){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Feature",idList:c.join(",")},success:function(g){Ext.getCmp("workspace_featuretoolbar").refreshWorkspaceViews()}})}}})}else{Ext.Msg.show({msg:"Do you want to delete this feature from your selected groups? Click No if you want to delete from entire workspace",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(f,e){if(f=="yes"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"groups",groups:a.join(","),idType:"Feature",idList:c.join(",")},success:function(g){Ext.getCmp("workspace_featuretoolbar").refreshWorkspaceViews()}})}else{if(f=="no"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Feature",idList:c.join(",")},success:function(g){Ext.getCmp("workspace_featuretoolbar").refreshWorkspaceViews()}})}}}})}}},{xtype:"tbar_btn_create",handler:function(a,c){var b=this.findParentByType("featuretoolbar").getSelectedID();if(b==null){return false}var d=new Ext.Button({text:"Save to Group",handler:function(f,g){saveToGroup(b.join(","),"Feature");Ext.getCmp("workspace_featuretoolbar").refreshWorkspaceViews()}});popup=Ext.create("VBI.Workspace.view.Toolbar.window.AddToGroup",{title:"Add Selected Features to Group",buttons:[d,{text:"Cancel",handler:function(){popup.hide()}}]}).show();loadATGCombo()}}]},"-",{title:"View",columns:1,xtype:"buttongroup",items:[{scale:"small",iconAlign:"left",text:"FASTA",width:110,xtype:"splitbutton",menu:[{scale:"small",iconAlign:"left",text:"FASTA DNA",icon:"/patric/images/toolbar_dna.png",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","display","dna",a.join(","))}}},{scale:"small",iconAlign:"left",text:"FASTA Protein",icon:"/patric/images/toolbar_protein.png",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","display","protein",a.join(","))}}},{scale:"small",iconAlign:"left",text:"FASTA DNA/Protein",icon:"/patric/images/toolbar_dna_protein.png",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","display","both",a.join(","))}}}]}]},{title:"Download",columns:1,xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(){this.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(){this.fireEvent("downloadGrid","xls")}}]},{scale:"small",iconAlign:"left",text:"FASTA",width:110,icon:"/patric/images/toolbar_fasta.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_dna",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","download","dna",a.join(","))}}},{xtype:"tbar_menu_dn_protein",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","download","protein",a.join(","))}}},{xtype:"tbar_menu_dn_dnaprotein",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("ShowDownloadFasta","download","both",a.join(","))}}}]}]},{title:"Tools",xtype:"buttongroup",items:[{xtype:"tbar_btn_msa",width:80,handler:function(){var a=this.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("runMSAFeature",a.join(","))}}},{xtype:"tbar_btn_mapidsto",width:120,menu:{defaults:{height:16,style:"margin-left: 15px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;",plain:true},items:[{text:"<b>PATRIC Identifiers</b>",style:"margin-left: 5px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;"},{text:"PATRIC Locus Tag",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PATRIC Locus Tag",a.join(","))}}},{text:"PATRIC ID",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PATRIC ID",a.join(","))}}},{text:"PSEED ID",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PSEED ID",a.join(","))}}},{text:"<b>REFSEQ Identifiers</b>",style:"margin-left: 5px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;"},{text:"RefSeq Locus Tag",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","RefSeq Locus Tag",a.join(","))}}},{text:"RefSeq",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","RefSeq",a.join(","))}}},{text:"Gene ID",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Gene ID",a.join(","))}}},{text:"GI",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GI",a.join(","))}}},{text:"<b>Other Identifiers</b>",style:"margin-left: 5px; margin-bottom: 0px; margin-right: 0px; margin-top: 5px;"},{text:"Allergome",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Allergome",a.join(","))}}},{text:"BioCyc",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","BioCyc",a.join(","))}}},{text:"DIP",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","DIP",a.join(","))}}},{text:"DisProt",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","DisProt",a.join(","))}}},{text:"DrugBank",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","DrugBank",a.join(","))}}},{text:"ECO2DBASE",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","ECO2DBASE",a.join(","))}}},{text:"EMBL",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EMBL",a.join(","))}}},{text:"EMBL-CDS",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EMBL-CDS",a.join(","))}}},{text:"EchoBASE",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EchoBASE",a.join(","))}}},{text:"EcoGene",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EcoGene",a.join(","))}}},{text:"EnsemblGenome",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EnsemblGenome",a.join(","))}}},{text:"EnsemblGenome_PRO",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EnsemblGenome_PRO",a.join(","))}}},{text:"EnsemblGenome_TRS",handler:function(){var a=this.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","EnsemblGenome_TRS",a.join(","))}}},{text:"More ...",itemCls:"x-menu-item-cstm",menu:[{text:"GeneTree",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GeneTree",a.join(","))}}},{text:"GenoList",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GenoList",a.join(","))}}},{text:"GenomeReviews",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","GenomeReviews",a.join(","))}}},{text:"HOGENOM",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","HOGENOM",a.join(","))}}},{text:"HSSP",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","HSSP",a.join(","))}}},{text:"KEGG",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","KEGG",a.join(","))}}},{text:"LegioList",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","LegioList",a.join(","))}}},{text:"Leproma",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Leproma",a.join(","))}}},{text:"MEROPS",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","MEROPS",a.join(","))}}},{text:"MINT",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","MINT",a.join(","))}}},{text:"NMPDR",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","NMPDR",a.join(","))}}},{text:"OMA",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","OMA",a.join(","))}}},{text:"OrthoDB",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","OrthoDB",a.join(","))}}},{text:"PDB",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PDB",a.join(","))}}},{text:"PeroxiBase",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PeroxiBase",a.join(","))}}},{text:"PptaseDB",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PptaseDB",a.join(","))}}},{text:"ProtClustDB",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","ProtClustDB",a.join(","))}}},{text:"PseudoCAP",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","PseudoCAP",a.join(","))}}},{text:"REBASE",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","REBASE",a.join(","))}}},{text:"Reactome",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","Reactome",a.join(","))}}},{text:"RefSeq_NT",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","RefSeq_NT",a.join(","))}}},{text:"TCDB",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","TCDB",a.join(","))}}},{text:"TIGR",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","TIGR",a.join(","))}}},{text:"TubercuList",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","TubercuList",a.join(","))}}},{text:"UniParc",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniParc",a.join(","))}}},{text:"UniProtKB-ID",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniProtKB-ID",a.join(","))}}},{text:"UniRef100",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniRef100",a.join(","))}}},{text:"UniRef50",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniRef50",a.join(","))}}},{text:"UniRef90",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","UniRef90",a.join(","))}}},{text:"World-2DPAGE",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","World-2DPAGE",a.join(","))}}},{text:"eggNOG",handler:function(){var a=this.parentMenu.parentMenu.floatParent.findParentByType("featuretoolbar").getSelectedID();if(a==null){return false}else{this.fireEvent("callIDMapping","eggNOG",a.join(","))}}}]}]}}]},"->","-",{xtype:"tbar_btngrp_help"}];this.layout={type:"hbox",align:"stretch"};this.callParent(arguments)}});Ext.define("VBI.Workspace.view.FeatureView",{extend:"Ext.grid.Panel",alias:"widget.featureview",store:"Features",requires:["VBI.Workspace.view.FeatureToolbar"],id:"workspace_featureview",border:0,columns:{defaults:{align:"center"},items:[{text:"Genome",dataIndex:"genome_name",flex:2,align:"left",renderer:function(b,c,a){return Ext.String.format('<a href="Genome?cType=genome&cId={0}">{1}</a>',a.data.gid,b)}},{text:"Product Description",dataIndex:"product",flex:3,align:"left"},{text:"Locus Tag",dataIndex:"locus_tag",flex:2,align:"left",renderer:function(b,c,a){return Ext.String.format('<a href="Feature?cType=feature&cId={0}">{1}</a>',a.data.na_feature_id,b)}},{text:"Annotation",dataIndex:"annotation",flex:1},{text:"Feature Type",dataIndex:"feature_type",flex:1},{text:"Start",dataIndex:"start_max",flex:1,align:"right"},{text:"End",dataIndex:"end_min",flex:1,align:"right"},{text:"Length (NT)",dataIndex:"na_length",flex:1,align:"right"},{text:"Strand",dataIndex:"strand",flex:1},{text:"Accession",dataIndex:"accession",flex:1,hidden:true},{text:"RefSeq Locus Tag",dataIndex:"refseq_locus_tag",flex:1,hidden:true},{text:"RefSeq Protein",dataIndex:"refseq_protein_id",flex:1,hidden:true}]},dockedItems:[{xtype:"featuretoolbar",height:70,dock:"top"},{xtype:"patricpagingtoolbar",store:"Features",dock:"bottom",displayInfo:true}],selModel:Ext.create("Ext.selection.CheckboxModel"),initComponent:function(){this.callParent(arguments)}});Ext.define("VBI.Workspace.view.GenomeToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.genometoolbar",id:"workspace_genometoolbar",stateful:false,getSelectedGroup:function(){var a=Ext.getCmp("workspace_view");var c;var b=new Array();if(a.activeItem=="groupview"){c=new Array();b.push(Ext.getCmp("workspace_groupinfoeditor").record.get("tagId"))}else{c=Ext.getCmp("columnbrowser_groups").getSelectionModel().getSelection();Ext.Array.each(c,function(d){b.push(d.get("tagId"))})}return b},getSelectedID:function(){var a=Ext.getCmp("workspace_view");var c;if(a.activeItem=="groupview"){c=Ext.getCmp("workspace_genomegrid").getSelectionModel().getSelection()}else{c=Ext.getCmp("workspace_genomeview").getSelectionModel().getSelection()}if(c.length==0){Ext.Msg.alert("Alert","No genome was selected");return null}else{var b=new Array();Ext.Array.each(c,function(d){b.push(d.get("gid"))});return b}},refreshWorkspaceViews:function(){Ext.StoreManager.lookup("Mappings").load({callback:function(){Ext.StoreManager.lookup("Groups").load({callback:function(){Ext.StoreManager.lookup("ColumnBrowser").refresh({callback:function(){Ext.StoreManager.lookup("Stations").load({callback:function(){Ext.getCmp("workspace_station").setDefault("Genomes");updateCartInfo()}})}})}})}})},initComponent:function(){this.items=[{title:"Workspace",xtype:"buttongroup",columns:1,items:[{xtype:"tbar_btn_remove",handler:function(b,d){var a=this.findParentByType("genometoolbar").getSelectedGroup();var c=this.findParentByType("genometoolbar").getSelectedID();if(c==null){return false}if(a.length==0){Ext.Msg.show({msg:"Do you want to delete this genome from your workspace?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(f,e){if(f=="ok"&&c.length>0){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Genome",idList:c.join(",")},success:function(g){Ext.getCmp("workspace_genometoolbar").refreshWorkspaceViews()}})}}})}else{Ext.Msg.show({msg:"Do you want to delete this genome from your selected groups? Click No if you want to delete from entire workspace",buttons:Ext.Msg.YESNOCANCEL,icon:Ext.Msg.QUESTION,fn:function(f,e){if(f=="yes"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"groups",groups:a.join(","),idType:"Genome",idList:c.join(",")},success:function(g){Ext.getCmp("workspace_genometoolbar").refreshWorkspaceViews()}})}else{if(f=="no"){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeTrack",params:{removeFrom:"workspace",idType:"Genome",idList:c.join(",")},success:function(g){Ext.getCmp("workspace_genometoolbar").refreshWorkspaceViews()}})}}}})}}},{xtype:"tbar_btn_create",handler:function(a,c){var b=this.findParentByType("genometoolbar").getSelectedID();if(b==null){return false}var d=new Ext.Button({text:"Save to Group",handler:function(f,g){saveToGroup(b.join(","),"Genome");Ext.getCmp("workspace_genometoolbar").refreshWorkspaceViews()}});popup=Ext.create("VBI.Workspace.view.Toolbar.window.AddToGroup",{title:"Add Selected Genomes to Group",buttons:[d,{text:"Cancel",handler:function(){popup.hide()}}]}).show();loadATGCombo()}}]},"-",{title:"Download",columns:1,xtype:"buttongroup",width:115,items:[{scale:"small",iconAlign:"left",width:110,text:"Table",icon:"/patric/images/toolbar_table.png",xtype:"splitbutton",menu:[{xtype:"tbar_menu_dn_tb_txt",handler:function(){this.fireEvent("downloadGrid","txt")}},{xtype:"tbar_menu_dn_tb_xls",handler:function(){this.fireEvent("downloadGrid","xls")}}]}]},"->","-",{xtype:"tbar_btngrp_help"}];this.layout={type:"hbox",align:"stretch"};this.callParent(arguments)}});Ext.define("VBI.Workspace.view.GenomeView",{extend:"Ext.grid.Panel",alias:"widget.genomeview",store:"Genomes",requires:["VBI.Workspace.view.GenomeToolbar"],id:"workspace_genomeview",border:0,columns:{defaults:{align:"center"},items:[{text:"Organism Name",dataIndex:"genome_name",flex:2,align:"left",renderer:function(b,c,a){return Ext.String.format('<a href="Genome?cType=genome&cId={0}">{1}</a>',a.data.gid,b)}},{text:"Size",dataIndex:"length",flex:1},{text:"PATRIC CDS",dataIndex:"rast_cds",flex:1},{text:"Legacy BRC CDS",dataIndex:"brc_cds",flex:1},{text:"RefSeq CDS",dataIndex:"refseq_cds",flex:1},{text:"chromosome",dataIndex:"chromosome",flex:1},{text:"plasmid",dataIndex:"plasmid",flex:1}]},dockedItems:[{xtype:"genometoolbar",height:70,dock:"top"},{xtype:"patricpagingtoolbar",store:"Genomes",dock:"bottom",displayInfo:true}],selModel:Ext.create("Ext.selection.CheckboxModel"),initComponent:function(){this.callParent(arguments)}});Ext.define("VBI.Workspace.view.GlobalToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.globaltoolbar",id:"workspace_globaltoolbar",stateful:false,switchViewButtons:function(a){if(a==null){a=Ext.getCmp("workspace_view").activeItem}if(a=="listview"){this.getComponent("btnItemView").toggle(true,true);this.getComponent("btnGroupView").toggle(false,true)}else{this.getComponent("btnItemView").toggle(false,true);this.getComponent("btnGroupView").toggle(true,true)}},initComponent:function(){this.items=[{xtype:"tbtext",text:""},"->",{text:"(new feature group)",handler:function(){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=create",params:{group_name:"",group_desc:"description2",group_type:"Feature",tracks:"30098156,30169012,30176074,30216134,30255345,30285150,30330130,30312096,30300283,30405530,30558208,30532095,30509534,30465308,30653216,30639677,30645960,30722337,30680621,30938147",tags:"tag1, tag2, tag3, tag4"},disableCaching:false})}},{text:"(new genome group)",handler:function(){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=create",params:{group_name:"genome group",group_desc:"description",group_type:"Genome",tracks:"38055,25663,113143",tags:""},disableCaching:false})}},{text:"(status)",handler:function(){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=WSSupport&action=status",success:function(a){console.log(a.responseText)}})}},"-",{xtype:"button",itemId:"btnItemView",text:"Item View",icon:"/patric/images/workspace_item_view_icon.png",enableToggle:true,scope:this,handler:function(){this.fireEvent("switchToListView");this.switchViewButtons("listview")}},"-",{xtype:"button",itemId:"btnGroupView",text:"Group View",icon:"/patric/images/workspace_group_view_icon.png",enableToggle:true,scope:this,handler:function(){this.fireEvent("switchToGroupView");this.switchViewButtons("groupview")}}];this.callParent(arguments)}});Ext.define("VBI.Workspace.view.group.Browser",{extend:"Ext.view.View",alias:"widget.groupbrowser",store:"Groups",id:"workspace_groupbrowser",stateful:false,tpl:['<tpl for=".">','<div class="thumb-wrap">','<div class="thumb">',(!Ext.isIE6?'<img src="{thumb}"  alt="{name}" title="{name}" />':"<div style=\"width:76px;height:76px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{thumb}')\"></div>"),"</div>",'<div class="title">{[Ext.String.ellipsis(values.name, 20)]} ({members})</div>','<div class="type">{type} Group</div>','<div class="updated">Updated: {[Ext.Date.format(Ext.Date.parse(values.mdate, "Y-m-d H:i:s"), "x-date-relative")]}</div>',"</div>","</tpl>"],autoScroll:true,multiSelect:true,itemSelector:"div.thumb-wrap",cls:"x-browser-view",initComponent:function(){this.callParent(arguments)},listeners:{}});Ext.define("VBI.Workspace.view.group.DetailToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.detailtoolbar",items:[{text:"<font color=#fff><b>All Groups</b></font>",iconCls:"leftarrow",overCls:"",pressedCls:"",style:{"background-color":"#0a4773"},minWidth:95,itemId:"backButton",scope:this}]});Ext.define("VBI.Workspace.view.group.FeatureGrid",{extend:"Ext.grid.Panel",alias:"widget.featuregrid",store:"Features",id:"workspace_featuregrid",border:0,columns:[{text:"Genome",dataIndex:"genome_name",flex:2,renderer:function(b,c,a){return Ext.String.format('<a href="Genome?cType=genome&cId={0}">{1}</a>',a.data.gid,b)}},{text:"Product Description",dataIndex:"product",flex:3},{text:"Locus Tag",dataIndex:"locus_tag",flex:1,renderer:function(b,c,a){return Ext.String.format('<a href="Feature?cType=feature&cId={0}">{1}</a>',a.data.na_feature_id,b)}},{text:"Annotation",dataIndex:"annotation",flex:1},{text:"Feature Type",dataIndex:"feature_type",flex:1},{text:"Start",dataIndex:"start_max",flex:1},{text:"End",dataIndex:"end_min",flex:1},{text:"Length (NT)",dataIndex:"na_length",flex:1},{text:"Strand",dataIndex:"strand",flex:1},{text:"Accession",dataIndex:"accession",flex:1,hidden:true},{text:"RefSeq Locus Tag",dataIndex:"refseq_locus_tag",flex:1,hidden:true},{text:"RefSeq Protein",dataIndex:"refseq_protein_id",flex:1,hidden:true}],dockedItems:[{xtype:"patricpagingtoolbar",store:"Features",dock:"bottom",displayInfo:true}],selModel:Ext.create("Ext.selection.CheckboxModel"),initComponent:function(){this.callParent(arguments)}});Ext.define("VBI.Workspace.view.group.GenomeGrid",{extend:"Ext.grid.Panel",alias:"widget.genomegrid",store:"Genomes",id:"workspace_genomegrid",border:0,columns:[{text:"Organism Name",dataIndex:"genome_name",flex:2,renderer:function(b,c,a){return Ext.String.format('<a href="Genome?cType=genome&cId={0}">{1}</a>',a.data.gid,b)}},{text:"Size",dataIndex:"length",flex:1},{text:"PATRIC CDS",dataIndex:"rast_cds",flex:1},{text:"Legacy BRC CDS",dataIndex:"brc_cds",flex:1},{text:"RefSeq CDS",dataIndex:"refseq_cds",flex:1},{text:"chromosome",dataIndex:"chromosome",flex:1},{text:"plasmid",dataIndex:"plasmid",flex:1}],dockedItems:[{xtype:"patricpagingtoolbar",store:"Genomes",dock:"bottom",displayInfo:true}],selModel:Ext.create("Ext.selection.CheckboxModel"),initComponent:function(){this.callParent(arguments)}});Ext.define("VBI.Workspace.view.group.GroupInfoEditor",{extend:"Ext.form.Panel",alias:"widget.groupinfoeditor",id:"workspace_groupinfoeditor",stateful:false,width:225,minWidth:225,bodyPadding:8,cls:"x-infoeditor-view",defaultType:"displayfield",fieldDefaults:{labelAlign:"left",anchor:"100%",},items:[{xtype:"component",id:"group-viewer-thumb",stateful:false,tpl:['<tpl for=".">','<div class="thumb-wrap">','<div class="thumb">',(!Ext.isIE6?'<img src="{thumb}"  alt="{name}" title="{name}" />':"<div style=\"width:76px;height:76px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{thumb}')\"></div>"),"</div>","</div>","</tpl>"]},{xtype:"displayfield",name:"groupname",itemId:"groupname",hideLabel:true,allowBlank:false,style:{fontWeight:"bold",marginBottom:"3px"},value:"none"},{xtype:"displayfield",name:"updated_min",hideLabel:true,style:{paddingBottom:"5px",marginBottom:"5px",borderBottom:"1px dashed #000000"},value:"none"},{xtype:"displayfield",name:"descriptionlabel",fieldLabel:"<b>Description</b>",style:{marginBottom:"1px"},value:""},{xtype:"displayfield",name:"description",itemId:"description",hideLabel:true,style:{marginTop:"0px",marginBottom:"10px"},value:""},{xtype:"displayfield",name:"tags",fieldLabel:"<b>Tags</b>",labelWidth:32,style:{marginTop:"0px",marginBottom:"10px"},value:"none"},{xtype:"displayfield",name:"updated",fieldLabel:"<b>Last Updated</b>",labelWidth:85,style:{marginTop:"0px",marginBottom:"10px"},value:"none"},{xtype:"displayfield",name:"created",fieldLabel:"<b>Created</b>",labelWidth:50,style:{marginTop:"0px",marginBottom:"10px"},value:"none"},{xtype:"button",itemId:"editInfoBtn",text:"Edit",iconCls:"x-btn-edit",iconAlign:"right",scope:this,enableToggle:true}],loadRecord:function(a){this.record=a;Ext.getCmp("group-viewer-thumb").update({thumb:a.data.thumb});this.getForm().setValues({groupname:a.data.name,updated_min:Ext.Date.format(Ext.Date.parse(a.data.mdate,"Y-m-d H:i:s"),"x-date-relative"),description:a.data.desc,tags:a.data.tags,updated:Ext.Date.format(Ext.Date.parse(a.data.mdate,"Y-m-d H:i:s"),"M j, Y"),created:Ext.Date.format(Ext.Date.parse(a.data.cdate,"Y-m-d H:i:s"),"M j, Y"),owner:a.data.owner})},startEdit:function(){this.remove("groupname");this.insert(1,{xtype:"textfield",name:"groupname",itemId:"groupname",hideLabel:true,allowBlank:false,value:"none"});this.remove("description");this.insert(4,{xtype:"textareafield",name:"description",itemId:"description",hideLabel:true,allowBlank:true,grow:true,growMin:20,growMax:100,value:"none"});this.loadRecord(this.record);this.getComponent("editInfoBtn").setText("Save")},finishEdit:function(){var a=this.getForm().getValues();this.record.set("desc",a.description);this.record.set("name",a.groupname);Ext.StoreManager.lookup("Groups").sync();this.disableFields()},disableFields:function(){this.remove("groupname");this.insert(1,{xtype:"displayfield",name:"groupname",itemId:"groupname",hideLabel:true,allowBlank:false,style:{fontWeight:"bold",marginBottom:"3px"},value:"none"});this.remove("description");this.insert(4,{xtype:"displayfield",name:"description",itemId:"description",hideLabel:true,style:{marginTop:"0px",marginBottom:"15px"},value:""});this.loadRecord(this.record);this.getComponent("editInfoBtn").setText("Edit")}});Ext.define("VBI.Workspace.view.group.GroupToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.grouptoolbar",border:0,layout:{type:"hbox",align:"stretch"},id:"workspace_grouptoolbar",stateful:false,getSelectedID:function(){var b=Ext.getCmp("workspace_groupbrowser").getSelectionModel().getSelection();if(b.length==0){Ext.Msg.alert("Alert","no group selected");return null}else{var a=new Array();Ext.Array.each(b,function(c){a.push(c.get("tagId"))});return a}},getSelectedGroupType:function(){var a=Ext.getCmp("workspace_groupbrowser").getSelectionModel().getSelection();if(a.length>0){return a[0].get("type")}},refreshWorkspaceViews:function(){Ext.StoreManager.lookup("ColumnBrowser").refresh({callback:function(){Ext.StoreManager.lookup("Groups").load({callback:function(){Ext.StoreManager.lookup("Stations").load();updateCartInfo()}})}})},initComponent:function(){this.items=[{title:"Workspace",xtype:"buttongroup",columns:1,items:[{xtype:"tbar_btn_remove",handler:function(a,c){var b=this.findParentByType("grouptoolbar").getSelectedID();if(b==null){return false}Ext.Msg.show({msg:"Do you want to delete this group from your workspace?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(e,d){if(e=="ok"&&b.length>0){Ext.Ajax.request({url:"/portal/portal/patric/BreadCrumb/WorkspaceWindow?action=b&cacheability=PAGE&action_type=groupAction&action=removeGroup",params:{idList:b.join(",")},success:function(f){Ext.getCmp("workspace_grouptoolbar").refreshWorkspaceViews()}})}}})}}]},"-",{title:"Tools",xtype:"buttongroup",items:[{scale:"large",iconAlign:"left",text:"Group Explorer",icon:"/patric/images/toolbar_gse.png",handler:function(){var b=this.findParentByType("grouptoolbar").getSelectedID();if(b==null){return false}var a=this.findParentByType("grouptoolbar").getSelectedGroupType();this.fireEvent("runGroupExplorer",b.join(","),a)}}]},{title:"Sort",xtype:"buttongroup",columns:3,items:[{text:"Name Ascending",icon:"/patric/js/extjs4/resources/themes/images/default/grid/hmenu-asc.gif",handler:function(){Ext.StoreManager.lookup("Groups").sort("name","ASC")}},{text:"Oldest First",icon:"/patric/images/calendar_icon.png",handler:function(){Ext.StoreManager.lookup("Groups").sort("mdate","ASC")}},{text:"Smallest First",icon:"/patric/images/sort_count_asc.png",handler:function(){Ext.StoreManager.lookup("Groups").sort("members","ASC")}},{text:"Name Descending",icon:"/patric/js/extjs4/resources/themes/images/default/grid/hmenu-desc.gif",handler:function(){Ext.StoreManager.lookup("Groups").sort("name","DESC")}},{text:"Newest First",icon:"/patric/images/calendar_icon.png",handler:function(){Ext.StoreManager.lookup("Groups").sort("mdate","DESC")}},{text:"Largest First",icon:"/patric/images/sort_count_des.png",handler:function(){Ext.StoreManager.lookup("Groups").sort("members","DESC")}}]},"->","-",{xtype:"tbar_btngrp_help"}];this.callParent(arguments)}});Ext.define("VBI.Workspace.view.group.ViewDetail",{extend:"Ext.panel.Panel",alias:"widget.groupviewdetail",requires:["VBI.Workspace.view.group.GroupInfoEditor","VBI.Workspace.view.group.DetailToolbar","VBI.Workspace.view.group.GenomeGrid","VBI.Workspace.view.group.FeatureGrid"],border:0,layout:"border",height:"100%",items:[{region:"west",xtype:"groupinfoeditor"},{region:"center",xtype:"panel",layout:"card",activeItem:"features",id:"workspace_ingroupgrid",items:[{itemId:"genomes",xtype:"genomegrid"},{itemId:"features",xtype:"featuregrid"}]}],dockedItems:[{xtype:"detailtoolbar",dock:"top"}],initComponent:function(){this.callParent(arguments)}});Ext.define("VBI.Workspace.view.GroupView",{extend:"Ext.panel.Panel",alias:"widget.groupview",id:"workspace_groupview",requires:["VBI.Workspace.view.group.GroupToolbar","VBI.Workspace.view.group.Browser","VBI.Workspace.view.group.ViewDetail"],border:true,layout:"card",activeItem:"browser",stateful:false,dockedItems:[{xtype:"grouptoolbar",height:80}],items:[{itemId:"browser",xtype:"groupbrowser"},{itemId:"detail",xtype:"groupviewdetail"}],initComponent:function(){this.callParent(arguments)},showGroupBrowser:function(){var a=this.getDockedComponent(0);if(a.getXType()!="grouptoolbar"){this.removeDocked(a);this.addDocked(Ext.create("VBI.Workspace.view.group.GroupToolbar",{id:"workspace_grp_grptbar",height:80}))}this.getLayout().setActiveItem("browser")},showFeatureGroupDetail:function(){var a=this.getDockedComponent(0);if(a.getXType()!="featuretoolbar"){this.removeDocked(a);this.addDocked(Ext.create("VBI.Workspace.view.FeatureToolbar",{id:"workspace_grp_ftrtbar",height:80}))}this.getLayout().setActiveItem("detail")},showGenomeGroupDetail:function(){var a=this.getDockedComponent(0);if(a.getXType()!="genometoolbar"){this.removeDocked(a);this.addDocked(Ext.create("VBI.Workspace.view.GenomeToolbar",{id:"workspace_grp_gmntbar",height:80}))}this.getLayout().setActiveItem("detail")}});Ext.define("VBI.Workspace.view.ListView",{extend:"Ext.panel.Panel",alias:"widget.listview",requires:["VBI.Workspace.view.ColumnBrowser","VBI.Workspace.view.FeatureView","VBI.Workspace.view.GenomeView"],height:"100%",border:false,layout:"border",items:[{xtype:"columnbrowser",title:"Column Browser",width:200,region:"west",collapsible:true,resizable:true},{xtype:"panel",region:"center",layout:"card",activeItem:"featureview",id:"workspace_listview",stateful:false,flex:1,border:true,items:[{itemId:"featureview",xtype:"featureview"},{itemId:"genomeview",xtype:"genomeview"}]}],initComponent:function(){this.callParent(arguments)}});Ext.define("VBI.Workspace.view.PagingToolbar",{extend:"Ext.PagingToolbar",alias:"widget.patricpagingtoolbar",beforePageSizeText:"Show",afterPageSizeText:"per page",displayMsg:"Displaying record {0} - {1} of {2}",getPagingItems:function(){var a=this;return[{itemId:"first",tooltip:a.firstText,overflowText:a.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:true,handler:a.moveFirst,scope:a},{itemId:"prev",tooltip:a.prevText,overflowText:a.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:true,handler:a.movePrevious,scope:a},"-",a.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,hideTrigger:true,enableKeyEvents:true,selectOnFocus:true,submitValue:false,width:a.inputItemWidth,margins:"-1 2 3 2",listeners:{scope:a,keydown:a.onPagingKeyDown,blur:a.onPagingBlur}},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(a.afterPageText,1)},"-",{itemId:"next",tooltip:a.nextText,overflowText:a.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:true,handler:a.moveNext,scope:a},{itemId:"last",tooltip:a.lastText,overflowText:a.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:true,handler:a.moveLast,scope:a},"-",a.beforePageSizeText,{xtype:"numberfield",itemId:"pagesize",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:false,minValue:1,maxValue:64000,hideTrigger:true,enableKeyEvents:true,selectOnFocus:true,submitValue:false,width:50,margins:"-1 2 3 2",value:undefined,stateId:"workspace_pagesize",stateEvents:["change"],getState:function(){return{pageSize:this.value}},applyState:function(b){if((b==undefined||b.pageSize==undefined)&&this.value==undefined){var b={pageSize:100};this.setValue(b.pageSize)}else{if(b!=undefined&&this.value!=b.pageSize){this.setValue(b.pageSize)}}},listeners:{scope:a,specialKey:function(c,b){if(b.getKey()==b.ENTER){this.doRefresh()}}},onChange:function(g,e,d){var f=g,c=f===null;if(c==false){if(Ext.isString(a.store)){var b=Ext.StoreManager.lookup(a.store);b.currentPage=1;b.pageSize=f}else{a.store.currentPage=1;a.store.pageSize=f}}}},a.afterPageSizeText,"-",{itemId:"refresh",tooltip:a.refreshText,overflowText:a.refreshText,iconCls:Ext.baseCSSPrefix+"tbar-loading",handler:a.doRefresh,scope:a}]}});Ext.define("VBI.Workspace.view.StationsList",{extend:"Ext.tree.Panel",alias:"widget.stationslist",store:"Stations",border:true,rootVisible:false,hideHeaders:true,useArrows:true,id:"workspace_station",stateful:false,columns:[{xtype:"treecolumn",text:"Stations",dataIndex:"name",flex:1}],setDefault:function(a){if(a=="Genomes"){this.getView().select(1);var b=this.getStore().getNodeById(3);this.fireEvent("itemclick",this.getView(),b)}else{if(a=="Features"){this.getView().select(2);var b=this.getStore().getNodeById(2);this.fireEvent("itemclick",this.getView(),b)}}},initComponent:function(){this.callParent(arguments)}});Ext.define("VBI.Workspace.view.Toolbar.button.Remove",{extend:"Ext.Button",alias:"widget.tbar_btn_remove",scale:"small",iconAlign:"left",text:"Remove",width:110,icon:"/patric/images/toolbar_workspace_remove.png"});Ext.define("VBI.Workspace.view.Toolbar.button.Create",{extend:"Ext.Button",alias:"widget.tbar_btn_create",scale:"small",iconAlign:"left",text:"Create",width:110,icon:"/patric/images/toolbar_workspace_add.png"});Ext.define("VBI.Workspace.view.Toolbar.button.MSA",{extend:"Ext.Button",alias:"widget.tbar_btn_msa",scale:"large",iconAlign:"left",text:"M S A",icon:"/patric/images/toolbar_msa.png"});Ext.define("VBI.Workspace.view.Toolbar.button.MapIDsTo",{extend:"Ext.Button",alias:"widget.tbar_btn_mapidsto",scale:"large",iconAlign:"left",text:"MAP IDs to",icon:"/patric/images/toolbar_id_mapping.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_Table_Txt",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_tb_txt",scale:"small",iconAlign:"left",text:"Text File (.txt)",icon:"/patric/images/toolbar_text.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_Table_Xls",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_tb_xls",scale:"small",iconAlign:"left",text:"Excel file (.xls)",icon:"/patric/images/toolbar_excel.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_dna",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_dna",scale:"small",iconAlign:"left",text:"DNA",icon:"/patric/images/toolbar_dna.png",});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_protein",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_protein",scale:"small",iconAlign:"left",text:"Protein",icon:"/patric/images/toolbar_protein.png"});Ext.define("VBI.Workspace.view.Toolbar.menu.Download_dnaprotein",{extend:"Ext.menu.Item",alias:"widget.tbar_menu_dn_dnaprotein",scale:"small",iconAlign:"left",text:"DNA/Protein",icon:"/patric/images/toolbar_dna_protein.png"});Ext.define("VBI.Workspace.view.Toolbar.buttongroup.Help",{extend:"Ext.container.ButtonGroup",alias:"widget.tbar_btngrp_help",title:"Help",items:[{scale:"large",text:"FAQs",icon:"/patric/images/toolbar_faq.png",handler:function(){window.open("http://enews.patricbrc.org/faqs/","_new","menubar=1,resizable=1,scrollbars=1, fullscreen=1, toolbar=1,titlebar=1,status=1")}}]});Ext.define("VBI.Workspace.view.Toolbar.window.AddToGroup",{extend:"Ext.Window",alias:"widget.tbar_window_addtogroup",layout:"fit",width:350,height:280,closeAction:"hide",plain:true,modal:true,items:[ATGform]});Ext.define("VBI.Workspace.view.Viewport",{extend:"Ext.container.Viewport",requires:["VBI.Workspace.view.Toolbar","VBI.Workspace.view.GlobalToolbar","VBI.Workspace.view.PagingToolbar","VBI.Workspace.view.StationsList","VBI.Workspace.view.ListView","VBI.Workspace.view.GroupView"],layout:"fit",border:false,items:{xtype:"panel",dockedItems:[{dock:"top",xtype:"globaltoolbar",height:30}],layout:{type:"hbox",align:"stretch"},items:[{xtype:"stationslist",width:150},{xtype:"panel",id:"workspace_view",layout:"card",activeItem:"listview",stateEvents:["updateview"],getState:function(){return{activeItem:this.activeItem}},applyState:function(a){if(a!=undefined&&this.activeItem!=a.activeItem){this.activeItem=a.activeItem;this.fireEvent("updateview")}},flex:1,border:false,items:[{itemId:"listview",xtype:"listview"},{itemId:"groupview",xtype:"groupview"}]}]},initComponent:function(){var c=this,a=Ext.fly(document.body.parentNode),b;c.callParent(arguments);c.el=b=Ext.get("wksp");Ext.EventManager.onWindowResize(c.fireResize,c);c.width=Ext.Element.getViewportWidth()-20;c.height=Ext.Element.getViewportHeight()-300},fireResize:function(a,b){this.setSize(a-20,b-300)}});Ext.Loader.setConfig({enabled:true});Ext.state.Manager.setProvider(new Ext.state.CookieProvider({expires:new Date(new Date().getTime()+(1000*60*60*24*7))}));Ext.application({name:"VBI.Workspace",autoCreateViewport:true,launch:function(){},id:"workspace",models:["ColumnBrowser","Station","Feature","Genome","Group"],stores:["ColumnBrowser","ColumnBrowser.Groups","ColumnBrowser.Tags","Stations","Features","Genomes","Groups","Mappings"],controllers:["ColumnBrowser","Station","Feature","Genome","Group","GlobalToolbar"]});Date.prototype.getDayOfYear=function(){var a={1:31,2:28,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};if((this.getFullYear()-1900)%4==0){a[2]=29}var c=this.getDate();var b=this.getMonth()-1;while(b>0){c+=a[b];b--}return c};Ext.Date.formatFunctions["x-date-relative"]=formatRelativeDate;function formatRelativeDate(i){var i=this;var a=Ext.Date.getElapsed(i);var e=Ext.Date.format(i,"M j, Y");var f=Ext.Date.format(i,"g:i a");if(a<60000){return"A few seconds ago"}if(a<3000000){return"A few minutes ago"}if(a<4200000){return"About an hour ago"}var d=Ext.Date.format(i,"d F, Y H:i:s");var c=new Date(Ext.Date.format(i,"d F, Y H:i:s"));var b=new Date();var j=b.getDayOfYear()-c.getDayOfYear();var g=Math.floor(j/7);var h=(b.getDayOfYear()-c.getDayOfYear())%7;if(b.getFullYear()-c.getFullYear()>0){return e}if(b.getMonth()==c.getMonth()&&b.getDate()==c.getDate()){return"Today at "+f}if(b.getMonth()==c.getMonth()&&b.getDate()-c.getDate()==1){return"Yesterday at "+f}if(g==0||(g==1&&h==0)){return"Last "+Ext.Date.format(i,"l")}if(j<11){return j+" days ago"}if(g<7&&h==0){return g+" weeks ago"}if(g<7&&h<4){return"About "+g+" weeks ago"}if(g<7&&h>3){return"About "+(g+1)+" weeks ago"}return e};